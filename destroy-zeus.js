
                import {createRequire} from 'module'
                const require = createRequire(import.meta.url)
            
var ue=Object.create;var Z=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var de=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,he=Object.prototype.hasOwnProperty;var V=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,o)=>(typeof require<"u"?require:t)[o]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var F=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var ge=(r,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let g of de(t))!he.call(r,g)&&g!==o&&Z(r,g,{get:()=>t[g],enumerable:!(i=fe(t,g))||i.enumerable});return r};var j=(r,t,o)=>(o=r!=null?ue(pe(r)):{},ge(t||!r||!r.__esModule?Z(o,"default",{value:r,enumerable:!0}):o,r));var O=F((L,Q)=>{(function(r,t){typeof L=="object"?Q.exports=L=t():typeof define=="function"&&define.amd?define([],t):r.CryptoJS=t()})(L,function(){var r=r||function(t,o){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global<"u"&&global.crypto&&(i=global.crypto),!i&&typeof V=="function")try{i=V("crypto")}catch{}var g=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function e(){}return function(n){var l;return e.prototype=n,l=new e,e.prototype=null,l}}(),x={},w=x.lib={},m=w.Base=function(){return{extend:function(e){var n=y(this);return e&&n.mixIn(e),(!n.hasOwnProperty("init")||this.init===n.init)&&(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),c=w.WordArray=m.extend({init:function(e,n){e=this.words=e||[],n!=o?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||h).stringify(this)},concat:function(e){var n=this.words,l=e.words,f=this.sigBytes,v=e.sigBytes;if(this.clamp(),f%4)for(var p=0;p<v;p++){var R=l[p>>>2]>>>24-p%4*8&255;n[f+p>>>2]|=R<<24-(f+p)%4*8}else for(var S=0;S<v;S+=4)n[f+S>>>2]=l[S>>>2];return this.sigBytes+=v,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var e=m.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var n=[],l=0;l<e;l+=4)n.push(g());return new c.init(n,e)}}),b=x.enc={},h=b.Hex={stringify:function(e){for(var n=e.words,l=e.sigBytes,f=[],v=0;v<l;v++){var p=n[v>>>2]>>>24-v%4*8&255;f.push((p>>>4).toString(16)),f.push((p&15).toString(16))}return f.join("")},parse:function(e){for(var n=e.length,l=[],f=0;f<n;f+=2)l[f>>>3]|=parseInt(e.substr(f,2),16)<<24-f%8*4;return new c.init(l,n/2)}},a=b.Latin1={stringify:function(e){for(var n=e.words,l=e.sigBytes,f=[],v=0;v<l;v++){var p=n[v>>>2]>>>24-v%4*8&255;f.push(String.fromCharCode(p))}return f.join("")},parse:function(e){for(var n=e.length,l=[],f=0;f<n;f++)l[f>>>2]|=(e.charCodeAt(f)&255)<<24-f%4*8;return new c.init(l,n)}},s=b.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},d=w.BufferedBlockAlgorithm=m.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=s.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var n,l=this._data,f=l.words,v=l.sigBytes,p=this.blockSize,R=p*4,S=v/R;e?S=t.ceil(S):S=t.max((S|0)-this._minBufferSize,0);var _=S*p,z=t.min(_*4,v);if(_){for(var P=0;P<_;P+=p)this._doProcessBlock(f,P);n=f.splice(0,_),l.sigBytes-=z}return new c.init(n,z)},clone:function(){var e=m.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),C=w.Hasher=d.extend({cfg:m.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var n=this._doFinalize();return n},blockSize:512/32,_createHelper:function(e){return function(n,l){return new e.init(l).finalize(n)}},_createHmacHelper:function(e){return function(n,l){return new k.HMAC.init(e,l).finalize(n)}}}),k=x.algo={};return x}(Math);return r})});var ee=F((I,X)=>{(function(r,t){typeof I=="object"?X.exports=I=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(r.CryptoJS)})(I,function(r){return r.enc.Utf8})});var re=F((q,te)=>{(function(r,t){typeof q=="object"?te.exports=q=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(r.CryptoJS)})(q,function(r){return function(t){var o=r,i=o.lib,g=i.WordArray,y=i.Hasher,x=o.algo,w=[],m=[];(function(){function h(C){for(var k=t.sqrt(C),e=2;e<=k;e++)if(!(C%e))return!1;return!0}function a(C){return(C-(C|0))*4294967296|0}for(var s=2,d=0;d<64;)h(s)&&(d<8&&(w[d]=a(t.pow(s,1/2))),m[d]=a(t.pow(s,1/3)),d++),s++})();var c=[],b=x.SHA256=y.extend({_doReset:function(){this._hash=new g.init(w.slice(0))},_doProcessBlock:function(h,a){for(var s=this._hash.words,d=s[0],C=s[1],k=s[2],e=s[3],n=s[4],l=s[5],f=s[6],v=s[7],p=0;p<64;p++){if(p<16)c[p]=h[a+p]|0;else{var R=c[p-15],S=(R<<25|R>>>7)^(R<<14|R>>>18)^R>>>3,_=c[p-2],z=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;c[p]=S+c[p-7]+z+c[p-16]}var P=n&l^~n&f,M=d&C^d&k^C&k,D=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),J=(n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25),T=v+J+P+m[p]+c[p],E=D+M;v=f,f=l,l=n,n=e+T|0,e=k,k=C,C=d,d=T+E|0}s[0]=s[0]+d|0,s[1]=s[1]+C|0,s[2]=s[2]+k|0,s[3]=s[3]+e|0,s[4]=s[4]+n|0,s[5]=s[5]+l|0,s[6]=s[6]+f|0,s[7]=s[7]+v|0},_doFinalize:function(){var h=this._data,a=h.words,s=this._nDataBytes*8,d=h.sigBytes*8;return a[d>>>5]|=128<<24-d%32,a[(d+64>>>9<<4)+14]=t.floor(s/4294967296),a[(d+64>>>9<<4)+15]=s,h.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var h=y.clone.call(this);return h._hash=this._hash.clone(),h}});o.SHA256=y._createHelper(b),o.HmacSHA256=y._createHmacHelper(b)}(Math),r.SHA256})});var oe=F((W,ne)=>{(function(r,t){typeof W=="object"?ne.exports=W=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(r.CryptoJS)})(W,function(r){return function(){var t=r,o=t.lib,i=o.WordArray,g=t.enc,y=g.Base64={stringify:function(w){var m=w.words,c=w.sigBytes,b=this._map;w.clamp();for(var h=[],a=0;a<c;a+=3)for(var s=m[a>>>2]>>>24-a%4*8&255,d=m[a+1>>>2]>>>24-(a+1)%4*8&255,C=m[a+2>>>2]>>>24-(a+2)%4*8&255,k=s<<16|d<<8|C,e=0;e<4&&a+e*.75<c;e++)h.push(b.charAt(k>>>6*(3-e)&63));var n=b.charAt(64);if(n)for(;h.length%4;)h.push(n);return h.join("")},parse:function(w){var m=w.length,c=this._map,b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var h=0;h<c.length;h++)b[c.charCodeAt(h)]=h}var a=c.charAt(64);if(a){var s=w.indexOf(a);s!==-1&&(m=s)}return x(w,m,b)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function x(w,m,c){for(var b=[],h=0,a=0;a<m;a++)if(a%4){var s=c[w.charCodeAt(a-1)]<<a%4*2,d=c[w.charCodeAt(a)]>>>6-a%4*2,C=s|d;b[h>>>2]|=C<<24-h%4*8,h++}return i.create(b,h)}}(),r.enc.Base64})});import{readFile as Be,writeFile as Se}from"fs/promises";var B=[];for(let r=0;r<256;++r)B.push((r+256).toString(16).slice(1));function K(r,t=0){return(B[r[t+0]]+B[r[t+1]]+B[r[t+2]]+B[r[t+3]]+"-"+B[r[t+4]]+B[r[t+5]]+"-"+B[r[t+6]]+B[r[t+7]]+"-"+B[r[t+8]]+B[r[t+9]]+"-"+B[r[t+10]]+B[r[t+11]]+B[r[t+12]]+B[r[t+13]]+B[r[t+14]]+B[r[t+15]]).toLowerCase()}import{randomFillSync as me}from"crypto";var H=new Uint8Array(256),N=H.length;function $(){return N>H.length-16&&(me(H),N=0),H.slice(N,N+=16)}import{randomUUID as ve}from"crypto";var Y={randomUUID:ve};function ye(r,t,o){if(Y.randomUUID&&!t&&!r)return Y.randomUUID();r=r||{};let i=r.random??r.rng?.()??$();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){if(o=o||0,o<0||o+16>t.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let g=0;g<16;++g)t[o+g]=i[g];return t}return K(i)}var G=ye;var we=j(ee(),1),xe=j(re(),1),be=j(oe(),1);import{execSync as Ce}from"node:child_process";function u(r,t){if(r=="--")console.error("[Error] deployment exited abnormally due to an error: 1"),console.error("[Cause] "+t+`
`),process.exit(1);else try{return Ce(r,{encoding:"utf8"})}catch(o){console.error("[Error] deployment exited abnormally due to an error: "+o.status),console.error("[Cause] "+t+`
`),process.exit(1)}}function ie(r,t){for(let o=0;o<t.length;o++)if(t[o]==r)return!0;return!1}function ke(r,t){for(let o=0;o<t.length;o++)if(t[o]==r)return!0;return!1}function _e(r){var t=[];for(let i=0;i<r.length;i++){let g=r[i];var o=!1;for(let y=0;y<t.length;y++)if(t[y]===g){o=!0;break}o||t.push(g)}return t}function Ae(r,t){for(let o=0;o<t.length;o++)if(r===t[o].region)return!0;return!1}async function se(r){let t="cdk.context.json",o="./zeus.json",i="./deploy.log",g="./destroy.log";var y,x;u("which aws","aws cli is not installed on this host but required, exiting"),u("which cdk","aws cdk is not installed on this host but required, exiting"),u("which node","node is not installed on this host but required, exiting"),u("which npm","npm is not installed on this host but required, exiting");let w=await Be(new URL("./"+o,import.meta.url)),m=JSON.parse(w),c=m.profile,b=m.logRetentionPeriod,h=m.domain,a=m.siteRegions,s=m.agent.product,d=m.agent.email,C=m.agent.tier,k=m.agent.functions;u("whoami","Failed to get whoami").replace(/\n|\r/g,"").split(" ")[0].includes("cloudshell-user")?x=!1:(y=u("aws configure list-profiles | grep "+c,"Could not list aws profiles").replace(/\n|\r/g,"").split(" ")[0],y!==c?u("--","The profile name provided in "+o+" is not found ... exiting"):x=!0);let n=u("cdk --version","Could not determine the cdk version").replace(/\n|\r/g,"").split(" ")[0],l=u("cat cdkVersion","Could not determine the cdk build version").replace(/\n|\r/g,"").split(" ")[0];l>n&&(console.log(">>> Please install mininum aws-cdk version: "+l),console.log(x?">>> command: npm install -g aws-cdk@"+l:">>> cloudshell: sudo npm install -g aws-cdk@"+l),console.log(""),process.exit(1)),y=x?u("aws sts get-caller-identity --profile "+c,"Unable to retrie account id for this profile: ["+c+" ] ... exiting"):u("aws sts get-caller-identity","Unable to retrive account id from cloudshell ... exiting");let f=JSON.parse(y).Account;y=x?u("aws configure get region --profile "+c,"Unable to retrie default region for this profile: ["+c+" ] ... exiting"):u("echo $AWS_DEFAULT_REGION","Unable to default region from cloudshell ... exiting");let v=y.replace(/\n|\r/g,"");y=x?u("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text --profile "+c,"Unable to retrie enabled regions for this profile: ["+c+" ] ... exiting"):u("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text","Unable to retrive enabled regions from cloudshell ... exiting");let p=y.split(`
`).filter(Boolean),R=u("openssl md5 ./assets/*","Failed to generate chksum file for assets ... exiting"),S=u("cat version","Failed to read the version file ... exiting"),_=R.split(`
`).filter(Boolean);var z={};_.forEach(A=>{let U=A.split(")= "),ce=U[0].replace("MD5(",""),le=U[1];z[ce]=S.trim()+"_"+le}),Ae(v,a)||u("--","The default region: "+v+" must be included in the siteRegions configured, please correct it."),a.forEach(A=>{let U=A.region;ie(U,p)?ke(U,a)&&u("--","Found duplicate sites for region: "+U+". Only one site per region is permitted."):u("--","Region "+U+" is not enabled on your aws account, please enable it on the console.")}),ie(v,p)||u("--","Region "+v+" is not enabled on your aws account, please enable it on the console.");let P=G(),M={logRetentionPeriod:b,account:f,domain:h,siteRegions:a,systemID:P,product:s,email:d,tier:C,functions:k,chksums:z};await Se("./"+t,JSON.stringify(M,null,2),A=>{A&&u("--","An error occured saving the CDK Context: "+A)});let D=a.map(A=>A.region),J=_e(D);var T="cdk bootstrap ",E;if(J.forEach(A=>{var U="aws://"+f+"/"+A+" ";T+=U}),r=="deploy")T+=x?"--profile "+c+" >> "+i+" 2>&1":" >> "+i+" 2>&1",u("echo Bootstrap Command:  >> "+i),u("echo "+T+" >> "+i),E=x?"cdk deploy --all --require-approval never --profile "+c+" >> "+i+" 2>&1":"cdk deploy --all --require-approval never >> "+i+" 2>&1",u("echo Deploy Command:  >> "+i),u("echo "+E+" >> "+i);else if(r=="destroy"){T+="--profile "+c+" >> "+g+" 2>&1",T+=x?"--profile "+c+" >> "+g+" 2>&1":" >> "+g+" 2>&1",u("echo Bootstrap Command:  >> "+g),u("echo "+T+" >> "+g),E=x?"yes | cdk destroy --all --require-approval never --profile "+c+" >> "+g+" 2>&1":"yes | cdk destroy --all --require-approval never >> "+g+" 2>&1";let A=`"${E}"`;u("echo Destroy Command:  >> "+g),u("echo "+A+" >> "+g)}return{bootstrap:T,execute:E,siteRegionsFlat:D,domainName:h}}var Re="./destroy.log";u("echo Destroy Sites Start > "+Re,"Problem initializing logfile ... exiting");console.log("[Info]:");console.log("    [] Destroying zeus ... Please be patient");console.log(`    [] Real Time View:> tail -f destroy.log 
`);var Te="destroy",ae=await se(Te),Ue=ae.bootstrap,ze=ae.execute;u(Ue,"Something went wrong bootstrapping the environment, see: destroy.log");u(ze,"Something went wrong while destroying, see: destroy.log");console.log("[Status]:");console.log(`    [] Success ... Stacks Deleted
`);process.exit(0);
