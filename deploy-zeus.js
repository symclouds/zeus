
                import {createRequire} from 'module'
                const require = createRequire(import.meta.url)
            
var de=Object.create;var K=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var he=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var V=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,o)=>(typeof require<"u"?require:t)[o]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var N=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var ve=(n,t,o,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let g of he(t))!me.call(n,g)&&g!==o&&K(n,g,{get:()=>t[g],enumerable:!(i=pe(t,g))||i.enumerable});return n};var $=(n,t,o)=>(o=n!=null?de(ge(n)):{},ve(t||!n||!n.__esModule?K(o,"default",{value:n,enumerable:!0}):o,n));var O=N((D,Q)=>{(function(n,t){typeof D=="object"?Q.exports=D=t():typeof define=="function"&&define.amd?define([],t):n.CryptoJS=t()})(D,function(){var n=n||function(t,o){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global<"u"&&global.crypto&&(i=global.crypto),!i&&typeof V=="function")try{i=V("crypto")}catch{}var g=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function e(){}return function(r){var l;return e.prototype=r,l=new e,e.prototype=null,l}}(),x={},w=x.lib={},m=w.Base=function(){return{extend:function(e){var r=y(this);return e&&r.mixIn(e),(!r.hasOwnProperty("init")||this.init===r.init)&&(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),c=w.WordArray=m.extend({init:function(e,r){e=this.words=e||[],r!=o?this.sigBytes=r:this.sigBytes=e.length*4},toString:function(e){return(e||h).stringify(this)},concat:function(e){var r=this.words,l=e.words,f=this.sigBytes,v=e.sigBytes;if(this.clamp(),f%4)for(var p=0;p<v;p++){var R=l[p>>>2]>>>24-p%4*8&255;r[f+p>>>2]|=R<<24-(f+p)%4*8}else for(var k=0;k<v;k+=4)r[f+k>>>2]=l[k>>>2];return this.sigBytes+=v,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var e=m.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var r=[],l=0;l<e;l+=4)r.push(g());return new c.init(r,e)}}),b=x.enc={},h=b.Hex={stringify:function(e){for(var r=e.words,l=e.sigBytes,f=[],v=0;v<l;v++){var p=r[v>>>2]>>>24-v%4*8&255;f.push((p>>>4).toString(16)),f.push((p&15).toString(16))}return f.join("")},parse:function(e){for(var r=e.length,l=[],f=0;f<r;f+=2)l[f>>>3]|=parseInt(e.substr(f,2),16)<<24-f%8*4;return new c.init(l,r/2)}},a=b.Latin1={stringify:function(e){for(var r=e.words,l=e.sigBytes,f=[],v=0;v<l;v++){var p=r[v>>>2]>>>24-v%4*8&255;f.push(String.fromCharCode(p))}return f.join("")},parse:function(e){for(var r=e.length,l=[],f=0;f<r;f++)l[f>>>2]|=(e.charCodeAt(f)&255)<<24-f%4*8;return new c.init(l,r)}},s=b.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},d=w.BufferedBlockAlgorithm=m.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=s.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var r,l=this._data,f=l.words,v=l.sigBytes,p=this.blockSize,R=p*4,k=v/R;e?k=t.ceil(k):k=t.max((k|0)-this._minBufferSize,0);var _=k*p,U=t.min(_*4,v);if(_){for(var z=0;z<_;z+=p)this._doProcessBlock(f,z);r=f.splice(0,_),l.sigBytes-=U}return new c.init(r,U)},clone:function(){var e=m.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),C=w.Hasher=d.extend({cfg:m.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var r=this._doFinalize();return r},blockSize:512/32,_createHelper:function(e){return function(r,l){return new e.init(l).finalize(r)}},_createHmacHelper:function(e){return function(r,l){return new S.HMAC.init(e,l).finalize(r)}}}),S=x.algo={};return x}(Math);return n})});var ee=N((L,X)=>{(function(n,t){typeof L=="object"?X.exports=L=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(n.CryptoJS)})(L,function(n){return n.enc.Utf8})});var ne=N((H,te)=>{(function(n,t){typeof H=="object"?te.exports=H=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(n.CryptoJS)})(H,function(n){return function(t){var o=n,i=o.lib,g=i.WordArray,y=i.Hasher,x=o.algo,w=[],m=[];(function(){function h(C){for(var S=t.sqrt(C),e=2;e<=S;e++)if(!(C%e))return!1;return!0}function a(C){return(C-(C|0))*4294967296|0}for(var s=2,d=0;d<64;)h(s)&&(d<8&&(w[d]=a(t.pow(s,1/2))),m[d]=a(t.pow(s,1/3)),d++),s++})();var c=[],b=x.SHA256=y.extend({_doReset:function(){this._hash=new g.init(w.slice(0))},_doProcessBlock:function(h,a){for(var s=this._hash.words,d=s[0],C=s[1],S=s[2],e=s[3],r=s[4],l=s[5],f=s[6],v=s[7],p=0;p<64;p++){if(p<16)c[p]=h[a+p]|0;else{var R=c[p-15],k=(R<<25|R>>>7)^(R<<14|R>>>18)^R>>>3,_=c[p-2],U=(_<<15|_>>>17)^(_<<13|_>>>19)^_>>>10;c[p]=k+c[p-7]+U+c[p-16]}var z=r&l^~r&f,J=d&C^d&S^C&S,F=(d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22),j=(r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25),E=v+j+z+m[p]+c[p],P=F+J;v=f,f=l,l=r,r=e+E|0,e=S,S=C,C=d,d=E+P|0}s[0]=s[0]+d|0,s[1]=s[1]+C|0,s[2]=s[2]+S|0,s[3]=s[3]+e|0,s[4]=s[4]+r|0,s[5]=s[5]+l|0,s[6]=s[6]+f|0,s[7]=s[7]+v|0},_doFinalize:function(){var h=this._data,a=h.words,s=this._nDataBytes*8,d=h.sigBytes*8;return a[d>>>5]|=128<<24-d%32,a[(d+64>>>9<<4)+14]=t.floor(s/4294967296),a[(d+64>>>9<<4)+15]=s,h.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var h=y.clone.call(this);return h._hash=this._hash.clone(),h}});o.SHA256=y._createHelper(b),o.HmacSHA256=y._createHmacHelper(b)}(Math),n.SHA256})});var oe=N((I,re)=>{(function(n,t){typeof I=="object"?re.exports=I=t(O()):typeof define=="function"&&define.amd?define(["./core"],t):t(n.CryptoJS)})(I,function(n){return function(){var t=n,o=t.lib,i=o.WordArray,g=t.enc,y=g.Base64={stringify:function(w){var m=w.words,c=w.sigBytes,b=this._map;w.clamp();for(var h=[],a=0;a<c;a+=3)for(var s=m[a>>>2]>>>24-a%4*8&255,d=m[a+1>>>2]>>>24-(a+1)%4*8&255,C=m[a+2>>>2]>>>24-(a+2)%4*8&255,S=s<<16|d<<8|C,e=0;e<4&&a+e*.75<c;e++)h.push(b.charAt(S>>>6*(3-e)&63));var r=b.charAt(64);if(r)for(;h.length%4;)h.push(r);return h.join("")},parse:function(w){var m=w.length,c=this._map,b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var h=0;h<c.length;h++)b[c.charCodeAt(h)]=h}var a=c.charAt(64);if(a){var s=w.indexOf(a);s!==-1&&(m=s)}return x(w,m,b)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function x(w,m,c){for(var b=[],h=0,a=0;a<m;a++)if(a%4){var s=c[w.charCodeAt(a-1)]<<a%4*2,d=c[w.charCodeAt(a)]>>>6-a%4*2,C=s|d;b[h>>>2]|=C<<24-h%4*8,h++}return i.create(b,h)}}(),n.enc.Base64})});var be=$(ee(),1),Ce=$(ne(),1),Be=$(oe(),1);var B=[];for(let n=0;n<256;++n)B.push((n+256).toString(16).slice(1));function ie(n,t=0){return(B[n[t+0]]+B[n[t+1]]+B[n[t+2]]+B[n[t+3]]+"-"+B[n[t+4]]+B[n[t+5]]+"-"+B[n[t+6]]+B[n[t+7]]+"-"+B[n[t+8]]+B[n[t+9]]+"-"+B[n[t+10]]+B[n[t+11]]+B[n[t+12]]+B[n[t+13]]+B[n[t+14]]+B[n[t+15]]).toLowerCase()}import{randomFillSync as ye}from"crypto";var W=new Uint8Array(256),q=W.length;function Y(){return q>W.length-16&&(ye(W),q=0),W.slice(q,q+=16)}import{randomUUID as we}from"crypto";var Z={randomUUID:we};function xe(n,t,o){if(Z.randomUUID&&!t&&!n)return Z.randomUUID();n=n||{};let i=n.random??n.rng?.()??Y();if(i.length<16)throw new Error("Random bytes length must be >= 16");if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t){if(o=o||0,o<0||o+16>t.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let g=0;g<16;++g)t[o+g]=i[g];return t}return ie(i)}var G=xe;import{readFile as Se,writeFile as _e}from"fs/promises";import{execSync as ke}from"node:child_process";function u(n,t){if(n=="--")console.error("[Error] deployment exited abnormally due to an error: 1"),console.error("[Cause] "+t+`
`),process.exit(1);else try{return ke(n,{encoding:"utf8"})}catch(o){console.error("[Error] deployment exited abnormally due to an error: "+o.status),console.error("[Cause] "+t+`
`),process.exit(1)}}function se(n,t){for(let o=0;o<t.length;o++)if(t[o]==n)return!0;return!1}function Ae(n,t){for(let o=0;o<t.length;o++)if(t[o]==n)return!0;return!1}function Re(n){var t=[];for(let i=0;i<n.length;i++){let g=n[i];var o=!1;for(let y=0;y<t.length;y++)if(t[y]===g){o=!0;break}o||t.push(g)}return t}function Ee(n,t){for(let o=0;o<t.length;o++)if(n===t[o].region)return!0;return!1}async function ae(n){let t="cdk.context.json",o="./zeus.json",i="./deploy.log",g="./destroy.log";var y,x;u("which aws","aws cli is not installed on this host but required, exiting"),u("which cdk","aws cdk is not installed on this host but required, exiting"),u("which node","node is not installed on this host but required, exiting"),u("which npm","npm is not installed on this host but required, exiting");let w=await Se(new URL("./"+o,import.meta.url)),m=JSON.parse(w),c=m.profile,b=m.logRetentionPeriod,h=m.domain,a=m.siteRegions,s=m.agent.product,d=m.agent.email,C=m.agent.tier,S=m.agent.functions;u("whoami","Failed to get whoami").replace(/\n|\r/g,"").split(" ")[0].includes("cloudshell-user")?x=!1:(y=u("aws configure list-profiles | grep "+c,"Could not list aws profiles").replace(/\n|\r/g,"").split(" ")[0],y!==c?u("--","The profile name provided in "+o+" is not found ... exiting"):x=!0);let r=u("cdk --version","Could not determine the cdk version").replace(/\n|\r/g,"").split(" ")[0],l=u("cat cdkVersion","Could not determine the cdk build version").replace(/\n|\r/g,"").split(" ")[0];l>r&&(console.log(">>> Please install mininum aws-cdk version: "+l),console.log(x?">>> command: npm install -g aws-cdk@"+l:">>> cloudshell: sudo npm install -g aws-cdk@"+l),console.log(""),process.exit(1)),y=x?u("aws sts get-caller-identity --profile "+c,"Unable to retrie account id for this profile: ["+c+" ] ... exiting"):u("aws sts get-caller-identity","Unable to retrive account id from cloudshell ... exiting");let f=JSON.parse(y).Account;y=x?u("aws configure get region --profile "+c,"Unable to retrie default region for this profile: ["+c+" ] ... exiting"):u("echo $AWS_DEFAULT_REGION","Unable to default region from cloudshell ... exiting");let v=y.replace(/\n|\r/g,"");y=x?u("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text --profile "+c,"Unable to retrie enabled regions for this profile: ["+c+" ] ... exiting"):u("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text","Unable to retrive enabled regions from cloudshell ... exiting");let p=y.split(`
`).filter(Boolean),R=u("openssl md5 ./assets/*","Failed to generate chksum file for assets ... exiting"),k=u("cat version","Failed to read the version file ... exiting"),_=R.split(`
`).filter(Boolean);var U={};_.forEach(A=>{let T=A.split(")= "),ue=T[0].replace("MD5(",""),fe=T[1];U[ue]=k.trim()+"_"+fe}),Ee(v,a)||u("--","The default region: "+v+" must be included in the siteRegions configured, please correct it."),a.forEach(A=>{let T=A.region;se(T,p)?Ae(T,a)&&u("--","Found duplicate sites for region: "+T+". Only one site per region is permitted."):u("--","Region "+T+" is not enabled on your aws account, please enable it on the console.")}),se(v,p)||u("--","Region "+v+" is not enabled on your aws account, please enable it on the console.");let z=G(),J={logRetentionPeriod:b,account:f,domain:h,siteRegions:a,systemID:z,product:s,email:d,tier:C,functions:S,chksums:U};await _e("./"+t,JSON.stringify(J,null,2),A=>{A&&u("--","An error occured saving the CDK Context: "+A)});let F=a.map(A=>A.region),j=Re(F);var E="cdk bootstrap ",P;if(j.forEach(A=>{var T="aws://"+f+"/"+A+" ";E+=T}),n=="deploy")E+=x?"--profile "+c+" >> "+i+" 2>&1":" >> "+i+" 2>&1",u("echo Bootstrap Command:  >> "+i),u("echo "+E+" >> "+i),P=x?"cdk deploy --all --require-approval never --profile "+c+" >> "+i+" 2>&1":"cdk deploy --all --require-approval never >> "+i+" 2>&1",u("echo Deploy Command:  >> "+i),u("echo "+P+" >> "+i);else if(n=="destroy"){E+=x?"--profile "+c+" >> "+g+" 2>&1":" >> "+g+" 2>&1",u("echo Bootstrap Command:  >> "+g),u("echo "+E+" >> "+g),P=x?"yes | cdk destroy --all --require-approval never --profile "+c+" >> "+g+" 2>&1":"yes | cdk destroy --all --require-approval never >> "+g+" 2>&1";let A=`"${P}"`;u("echo Destroy Command:  >> "+g),u("echo "+A+" >> "+g)}return{bootstrap:E,execute:P,siteRegionsFlat:F,domainName:h}}var le="./deploy.log";u("echo Deployment Start > "+le,"Problem initializing logfile ... exiting");var Te="deploy",M=await ae(Te),Ue=M.bootstrap,ze=M.execute,ce=M.siteRegionsFlat,Pe=M.domainName;u(Ue,"Something went wrong bootstrapping the environment, see: deploy.log");u(ze,"Something went wrong while deploying, see: deploy.log");cmdOutput=u("grep ZeusEndpoint  "+le+" | awk  '{print $(NF)}'");var Fe=cmdOutput.split(`
`).filter(Boolean);console.log(`[] zeus Integration Endpoints: ...
`);for(let n=0;n<ce.length;n++){let t=n+1;console.log("   [Site "+t+"]: "),console.log("       [Region]:       "+ce[n]),console.log("       [Endpoint]:     "+Fe[n]),console.log("")}console.log("   [Latency DNS Endpoint]:  https://<apps>."+Pe);
