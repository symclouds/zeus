
                import {createRequire} from 'module'
                const require = createRequire(import.meta.url)
            
var xe=Object.create;var ee=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var Ce=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,Be=Object.prototype.hasOwnProperty;var $=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var I=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var _e=(t,e,o,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let v of Ce(e))!Be.call(t,v)&&v!==o&&ee(t,v,{get:()=>e[v],enumerable:!(s=be(e,v))||s.enumerable});return t};var Y=(t,e,o)=>(o=t!=null?xe(ke(t)):{},_e(e||!t||!t.__esModule?ee(o,"default",{value:t,enumerable:!0}):o,t));var W=I((D,ne)=>{(function(t,e){typeof D=="object"?ne.exports=D=e():typeof define=="function"&&define.amd?define([],e):t.CryptoJS=e()})(D,function(){var t=t||function(e,o){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof global<"u"&&global.crypto&&(s=global.crypto),!s&&typeof $=="function")try{s=$("crypto")}catch{}var v=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},B=Object.create||function(){function n(){}return function(r){var c;return n.prototype=r,c=new n,n.prototype=null,c}}(),T={},m=T.lib={},y=m.Base=function(){return{extend:function(n){var r=B(this);return n&&r.mixIn(n),(!r.hasOwnProperty("init")||this.init===r.init)&&(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var r in n)n.hasOwnProperty(r)&&(this[r]=n[r]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=m.WordArray=y.extend({init:function(n,r){n=this.words=n||[],r!=o?this.sigBytes=r:this.sigBytes=n.length*4},toString:function(n){return(n||p).stringify(this)},concat:function(n){var r=this.words,c=n.words,l=this.sigBytes,g=n.sigBytes;if(this.clamp(),l%4)for(var f=0;f<g;f++){var z=c[f>>>2]>>>24-f%4*8&255;r[l+f>>>2]|=z<<24-(l+f)%4*8}else for(var k=0;k<g;k+=4)r[l+k>>>2]=c[k>>>2];return this.sigBytes+=g,this},clamp:function(){var n=this.words,r=this.sigBytes;n[r>>>2]&=4294967295<<32-r%4*8,n.length=e.ceil(r/4)},clone:function(){var n=y.clone.call(this);return n.words=this.words.slice(0),n},random:function(n){for(var r=[],c=0;c<n;c+=4)r.push(v());return new h.init(r,n)}}),w=T.enc={},p=w.Hex={stringify:function(n){for(var r=n.words,c=n.sigBytes,l=[],g=0;g<c;g++){var f=r[g>>>2]>>>24-g%4*8&255;l.push((f>>>4).toString(16)),l.push((f&15).toString(16))}return l.join("")},parse:function(n){for(var r=n.length,c=[],l=0;l<r;l+=2)c[l>>>3]|=parseInt(n.substr(l,2),16)<<24-l%8*4;return new h.init(c,r/2)}},a=w.Latin1={stringify:function(n){for(var r=n.words,c=n.sigBytes,l=[],g=0;g<c;g++){var f=r[g>>>2]>>>24-g%4*8&255;l.push(String.fromCharCode(f))}return l.join("")},parse:function(n){for(var r=n.length,c=[],l=0;l<r;l++)c[l>>>2]|=(n.charCodeAt(l)&255)<<24-l%4*8;return new h.init(c,r)}},i=w.Utf8={stringify:function(n){try{return decodeURIComponent(escape(a.stringify(n)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(n){return a.parse(unescape(encodeURIComponent(n)))}},u=m.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(n){typeof n=="string"&&(n=i.parse(n)),this._data.concat(n),this._nDataBytes+=n.sigBytes},_process:function(n){var r,c=this._data,l=c.words,g=c.sigBytes,f=this.blockSize,z=f*4,k=g/z;n?k=e.ceil(k):k=e.max((k|0)-this._minBufferSize,0);var S=k*f,H=e.min(S*4,g);if(S){for(var P=0;P<S;P+=f)this._doProcessBlock(l,P);r=l.splice(0,S),c.sigBytes-=H}return new h.init(r,H)},clone:function(){var n=y.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0}),b=m.Hasher=u.extend({cfg:y.extend(),init:function(n){this.cfg=this.cfg.extend(n),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(n){return this._append(n),this._process(),this},finalize:function(n){n&&this._append(n);var r=this._doFinalize();return r},blockSize:512/32,_createHelper:function(n){return function(r,c){return new n.init(c).finalize(r)}},_createHmacHelper:function(n){return function(r,c){return new _.HMAC.init(n,c).finalize(r)}}}),_=T.algo={};return T}(Math);return t})});var oe=I((q,re)=>{(function(t,e){typeof q=="object"?re.exports=q=e(W()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(q,function(t){return t.enc.Utf8})});var se=I((M,ie)=>{(function(t,e){typeof M=="object"?ie.exports=M=e(W()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(M,function(t){return function(e){var o=t,s=o.lib,v=s.WordArray,B=s.Hasher,T=o.algo,m=[],y=[];(function(){function p(b){for(var _=e.sqrt(b),n=2;n<=_;n++)if(!(b%n))return!1;return!0}function a(b){return(b-(b|0))*4294967296|0}for(var i=2,u=0;u<64;)p(i)&&(u<8&&(m[u]=a(e.pow(i,1/2))),y[u]=a(e.pow(i,1/3)),u++),i++})();var h=[],w=T.SHA256=B.extend({_doReset:function(){this._hash=new v.init(m.slice(0))},_doProcessBlock:function(p,a){for(var i=this._hash.words,u=i[0],b=i[1],_=i[2],n=i[3],r=i[4],c=i[5],l=i[6],g=i[7],f=0;f<64;f++){if(f<16)h[f]=p[a+f]|0;else{var z=h[f-15],k=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,S=h[f-2],H=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;h[f]=k+h[f-7]+H+h[f-16]}var P=r&c^~r&l,ve=u&b^u&_^b&_,me=(u<<30|u>>>2)^(u<<19|u>>>13)^(u<<10|u>>>22),ye=(r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25),X=g+ye+P+y[f]+h[f],we=me+ve;g=l,l=c,c=r,r=n+X|0,n=_,_=b,b=u,u=X+we|0}i[0]=i[0]+u|0,i[1]=i[1]+b|0,i[2]=i[2]+_|0,i[3]=i[3]+n|0,i[4]=i[4]+r|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+g|0},_doFinalize:function(){var p=this._data,a=p.words,i=this._nDataBytes*8,u=p.sigBytes*8;return a[u>>>5]|=128<<24-u%32,a[(u+64>>>9<<4)+14]=e.floor(i/4294967296),a[(u+64>>>9<<4)+15]=i,p.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var p=B.clone.call(this);return p._hash=this._hash.clone(),p}});o.SHA256=B._createHelper(w),o.HmacSHA256=B._createHmacHelper(w)}(Math),t.SHA256})});var ce=I((V,ae)=>{(function(t,e){typeof V=="object"?ae.exports=V=e(W()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(V,function(t){return function(){var e=t,o=e.lib,s=o.WordArray,v=e.enc,B=v.Base64={stringify:function(m){var y=m.words,h=m.sigBytes,w=this._map;m.clamp();for(var p=[],a=0;a<h;a+=3)for(var i=y[a>>>2]>>>24-a%4*8&255,u=y[a+1>>>2]>>>24-(a+1)%4*8&255,b=y[a+2>>>2]>>>24-(a+2)%4*8&255,_=i<<16|u<<8|b,n=0;n<4&&a+n*.75<h;n++)p.push(w.charAt(_>>>6*(3-n)&63));var r=w.charAt(64);if(r)for(;p.length%4;)p.push(r);return p.join("")},parse:function(m){var y=m.length,h=this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var p=0;p<h.length;p++)w[h.charCodeAt(p)]=p}var a=h.charAt(64);if(a){var i=m.indexOf(a);i!==-1&&(y=i)}return T(m,y,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function T(m,y,h){for(var w=[],p=0,a=0;a<y;a++)if(a%4){var i=h[m.charCodeAt(a-1)]<<a%4*2,u=h[m.charCodeAt(a)]>>>6-a%4*2,b=i|u;w[p>>>2]|=b<<24-p%4*8,p++}return s.create(w,p)}}(),t.enc.Base64})});import{readFile as Ue,writeFile as Pe}from"fs/promises";import{execSync as Ne}from"node:child_process";var x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).slice(1));function te(t,e=0){return(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase()}import{randomFillSync as Se}from"crypto";var O=new Uint8Array(256),L=O.length;function Z(){return L>O.length-16&&(Se(O),L=0),O.slice(L,L+=16)}import{randomUUID as Ae}from"crypto";var G={randomUUID:Ae};function Re(t,e,o){if(G.randomUUID&&!e&&!t)return G.randomUUID();t=t||{};let s=t.random??t.rng?.()??Z();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(o=o||0,o<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let v=0;v<16;++v)e[o+v]=s[v];return e}return te(s)}var K=Re;var ze=Y(oe(),1),Te=Y(se(),1),Ee=Y(ce(),1);function d(t,e){if(t=="--")console.error("[Error] zeus deployment exited abnormally due to an error: 1"),console.error("[Cause] "+e+`
`),process.exit(1);else try{return Ne(t,{encoding:"utf8"})}catch(o){console.error("[Error] zeus deployment exited abnormally due to an error: "+o.status),console.error("[Cause] "+e+`
`),process.exit(1)}}function le(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function Fe(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function He(t,e){for(let o=0;o<e.length;o++)if(t===e[o].region)return!0;return!1}function Ie(t){var e=[];for(let s=0;s<t.length;s++){let v=t[s];var o=!1;for(let B=0;B<e.length;B++)if(e[B]===v){o=!0;break}o||e.push(v)}return e}function Le(){}var Oe="cdk.context.json",ue="zeus.json",A="deploy.log";d("echo > "+A,"Problem initializing logfile ... exiting");var C,E;d("which aws","aws cli is not installed on this host but required, exiting");d("which cdk","aws cdk is not installed on this host but required, exiting");var De=await Ue(new URL("./"+ue,import.meta.url)),U=JSON.parse(De),R=U.profile,We=U.logRetentionPeriod,qe=U.domain,F=U.siteRegions,Me=U.agent.product,Ve=U.agent.email,Je=U.agent.tier,je=U.agent.functions,$e=d("whoami","");$e.includes("cloudshell-user")?E=!1:(C=d("aws configure list-profiles | grep "+R,"Could not list aws profiles"),C!==R?d("--","The profile name provided in "+ue+" is not found ... exiting"):E=!0);C=d("cdk --version","Could not determine the cdk version");var fe=C.replace(/\n|\r/g,"").split(" ")[0];C=d("cat cdkVersion","Could not determine the cdk build version");var N=C.replace(/\n|\r/g,"").split(" ")[0];console.log("cdkVersionBuilt:"+N);console.log("cdkVersionInstalled:"+fe);N>fe&&(console.log(">>> Please install mininum aws-cdk version: "+N),console.log(E?">>> command: npm install -g aws-cdk@"+N:">>> cloudshell: sudo npm install -g aws-cdk@"+N),console.log(""),process.exit(1));C=E?d("aws sts get-caller-identity --profile "+R,"Unable to retrie account id for this profile: ["+R+" ] ... exiting"):d("aws sts get-caller-identity","Unable to retrive account id from cloudshell ... exiting");var de=JSON.parse(C).Account;C=E?d("aws configure get region --profile "+R,"Unable to retrie default region for this profile: ["+R+" ] ... exiting"):d("echo $AWS_DEFAULT_REGION","Unable to default region from cloudshell ... exiting");var J=C.replace(/\n|\r/g,"");C=E?d("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text --profile "+R,"Unable to retrie enabled regions for this profile: ["+R+" ] ... exiting"):d("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text","Unable to retrive enabled regions from cloudshell ... exiting");var pe=C.split(`
`).filter(Boolean),Ye=d("openssl md5 ./assets/*","Failed to generate chksum file for assets ... exiting"),Ze=d("cat version","Failed to read the version file ... exiting"),Ge=Ye.split(`
`).filter(Boolean),he={};Ge.forEach(t=>{let e=t.split(")= "),o=e[0].replace("MD5(",""),s=e[1];he[o]=Ze.trim()+"_"+s});He(J,F)||d("--","The default region: "+J+" must be included in the siteRegions configured, please correct it.");F.forEach(t=>{let e=t.region;le(e,pe)?Fe(e,F)&&d("--","Found duplicate sites for region: "+e+". Only one site per region is permitted."):d("--","Region "+e+" is not enabled on your aws account, please enable it on the console.")});le(J,pe)||d("--","Region "+J+" is not enabled on your aws account, please enable it on the console.");var Ke=K(),Qe={logRetentionPeriod:We,account:de,domain:qe,siteRegions:F,systemID:Ke,product:Me,email:Ve,tier:Je,functions:je,chksums:he};await Pe("./"+Oe,JSON.stringify(Qe,null,2),t=>{t&&d("--","An error occured saving the CDK Context: "+t)});var Q=F.map(t=>t.region),Xe=Ie(Q),j="cdk bootstrap ";Xe.forEach(t=>{var e="aws://"+de+"/"+t+" ";j+=e});j+=E?"--profile "+R+" >> "+A+" 2>&1":" >> "+A+" 2>&1";d("echo Bootstrap Command:  >> "+A);d("echo "+j+" >> "+A);var ge=E?"cdk deploy --all --require-approval never --profile "+R+" >> "+A+" 2>&1":"cdk deploy --all --require-approval never >> "+A+" 2>&1";d("echo Deploy Command:  >> "+A);d("echo "+ge+" >> "+A);d(j,"Something went wrong bootstrapping the environment, see: deploy.log");d(ge,"Something went wrong while deploying the zeus AuthN AuthZ system stacks, see: deploy.log");C=d("grep ZeusEndpoint  "+A+" | awk  '{print $(NF)}'");var et=C.split(`
`).filter(Boolean);console.log(`[] zeus Integration Endpoints: ...
`);for(let t=0;t<Q.length;t++){let e=t+1;console.log("   [Site "+e+"]: "),console.log("       [Region]:     "+Q[t]),console.log("       [Endpoint]:   "+et[t]),console.log("")}export{Le as default};
