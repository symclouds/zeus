
                import {createRequire} from 'module'
                const require = createRequire(import.meta.url)
            
var ve=Object.create;var Q=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty;var j=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var be=(t,e,o,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let v of ye(e))!xe.call(t,v)&&v!==o&&Q(t,v,{get:()=>e[v],enumerable:!(s=me(e,v))||s.enumerable});return t};var Y=(t,e,o)=>(o=t!=null?ve(we(t)):{},be(e||!t||!t.__esModule?Q(o,"default",{value:t,enumerable:!0}):o,t));var D=N((O,ee)=>{(function(t,e){typeof O=="object"?ee.exports=O=e():typeof define=="function"&&define.amd?define([],e):t.CryptoJS=e()})(O,function(){var t=t||function(e,o){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof global<"u"&&global.crypto&&(s=global.crypto),!s&&typeof j=="function")try{s=j("crypto")}catch{}var v=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},B=Object.create||function(){function r(){}return function(n){var c;return r.prototype=n,c=new r,r.prototype=null,c}}(),A={},m=A.lib={},y=m.Base=function(){return{extend:function(r){var n=B(this);return r&&n.mixIn(r),(!n.hasOwnProperty("init")||this.init===n.init)&&(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),p=m.WordArray=y.extend({init:function(r,n){r=this.words=r||[],n!=o?this.sigBytes=n:this.sigBytes=r.length*4},toString:function(r){return(r||d).stringify(this)},concat:function(r){var n=this.words,c=r.words,l=this.sigBytes,h=r.sigBytes;if(this.clamp(),l%4)for(var f=0;f<h;f++){var k=c[f>>>2]>>>24-f%4*8&255;n[l+f>>>2]|=k<<24-(l+f)%4*8}else for(var C=0;C<h;C+=4)n[l+C>>>2]=c[C>>>2];return this.sigBytes+=h,this},clamp:function(){var r=this.words,n=this.sigBytes;r[n>>>2]&=4294967295<<32-n%4*8,r.length=e.ceil(n/4)},clone:function(){var r=y.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var n=[],c=0;c<r;c+=4)n.push(v());return new p.init(n,r)}}),w=A.enc={},d=w.Hex={stringify:function(r){for(var n=r.words,c=r.sigBytes,l=[],h=0;h<c;h++){var f=n[h>>>2]>>>24-h%4*8&255;l.push((f>>>4).toString(16)),l.push((f&15).toString(16))}return l.join("")},parse:function(r){for(var n=r.length,c=[],l=0;l<n;l+=2)c[l>>>3]|=parseInt(r.substr(l,2),16)<<24-l%8*4;return new p.init(c,n/2)}},a=w.Latin1={stringify:function(r){for(var n=r.words,c=r.sigBytes,l=[],h=0;h<c;h++){var f=n[h>>>2]>>>24-h%4*8&255;l.push(String.fromCharCode(f))}return l.join("")},parse:function(r){for(var n=r.length,c=[],l=0;l<n;l++)c[l>>>2]|=(r.charCodeAt(l)&255)<<24-l%4*8;return new p.init(c,n)}},i=w.Utf8={stringify:function(r){try{return decodeURIComponent(escape(a.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return a.parse(unescape(encodeURIComponent(r)))}},u=m.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new p.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=i.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var n,c=this._data,l=c.words,h=c.sigBytes,f=this.blockSize,k=f*4,C=h/k;r?C=e.ceil(C):C=e.max((C|0)-this._minBufferSize,0);var S=C*f,H=e.min(S*4,h);if(S){for(var U=0;U<S;U+=f)this._doProcessBlock(l,U);n=l.splice(0,S),c.sigBytes-=H}return new p.init(n,H)},clone:function(){var r=y.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0}),b=m.Hasher=u.extend({cfg:y.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var n=this._doFinalize();return n},blockSize:512/32,_createHelper:function(r){return function(n,c){return new r.init(c).finalize(n)}},_createHmacHelper:function(r){return function(n,c){return new _.HMAC.init(r,c).finalize(n)}}}),_=A.algo={};return A}(Math);return t})});var re=N((I,te)=>{(function(t,e){typeof I=="object"?te.exports=I=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(I,function(t){return t.enc.Utf8})});var oe=N((W,ne)=>{(function(t,e){typeof W=="object"?ne.exports=W=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(W,function(t){return function(e){var o=t,s=o.lib,v=s.WordArray,B=s.Hasher,A=o.algo,m=[],y=[];(function(){function d(b){for(var _=e.sqrt(b),r=2;r<=_;r++)if(!(b%r))return!1;return!0}function a(b){return(b-(b|0))*4294967296|0}for(var i=2,u=0;u<64;)d(i)&&(u<8&&(m[u]=a(e.pow(i,1/2))),y[u]=a(e.pow(i,1/3)),u++),i++})();var p=[],w=A.SHA256=B.extend({_doReset:function(){this._hash=new v.init(m.slice(0))},_doProcessBlock:function(d,a){for(var i=this._hash.words,u=i[0],b=i[1],_=i[2],r=i[3],n=i[4],c=i[5],l=i[6],h=i[7],f=0;f<64;f++){if(f<16)p[f]=d[a+f]|0;else{var k=p[f-15],C=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,S=p[f-2],H=(S<<15|S>>>17)^(S<<13|S>>>19)^S>>>10;p[f]=C+p[f-7]+H+p[f-16]}var U=n&c^~n&l,de=u&b^u&_^b&_,pe=(u<<30|u>>>2)^(u<<19|u>>>13)^(u<<10|u>>>22),he=(n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25),K=h+he+U+y[f]+p[f],ge=pe+de;h=l,l=c,c=n,n=r+K|0,r=_,_=b,b=u,u=K+ge|0}i[0]=i[0]+u|0,i[1]=i[1]+b|0,i[2]=i[2]+_|0,i[3]=i[3]+r|0,i[4]=i[4]+n|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+h|0},_doFinalize:function(){var d=this._data,a=d.words,i=this._nDataBytes*8,u=d.sigBytes*8;return a[u>>>5]|=128<<24-u%32,a[(u+64>>>9<<4)+14]=e.floor(i/4294967296),a[(u+64>>>9<<4)+15]=i,d.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var d=B.clone.call(this);return d._hash=this._hash.clone(),d}});o.SHA256=B._createHelper(w),o.HmacSHA256=B._createHmacHelper(w)}(Math),t.SHA256})});var se=N((q,ie)=>{(function(t,e){typeof q=="object"?ie.exports=q=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(q,function(t){return function(){var e=t,o=e.lib,s=o.WordArray,v=e.enc,B=v.Base64={stringify:function(m){var y=m.words,p=m.sigBytes,w=this._map;m.clamp();for(var d=[],a=0;a<p;a+=3)for(var i=y[a>>>2]>>>24-a%4*8&255,u=y[a+1>>>2]>>>24-(a+1)%4*8&255,b=y[a+2>>>2]>>>24-(a+2)%4*8&255,_=i<<16|u<<8|b,r=0;r<4&&a+r*.75<p;r++)d.push(w.charAt(_>>>6*(3-r)&63));var n=w.charAt(64);if(n)for(;d.length%4;)d.push(n);return d.join("")},parse:function(m){var y=m.length,p=this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var d=0;d<p.length;d++)w[p.charCodeAt(d)]=d}var a=p.charAt(64);if(a){var i=m.indexOf(a);i!==-1&&(y=i)}return A(m,y,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function A(m,y,p){for(var w=[],d=0,a=0;a<y;a++)if(a%4){var i=p[m.charCodeAt(a-1)]<<a%4*2,u=p[m.charCodeAt(a)]>>>6-a%4*2,b=i|u;w[d>>>2]|=b<<24-d%4*8,d++}return s.create(w,d)}}(),t.enc.Base64})});import{readFile as ze,writeFile as Re}from"fs/promises";import{execSync as Te}from"node:child_process";var x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).slice(1));function X(t,e=0){return(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase()}import{randomFillSync as Ce}from"crypto";var L=new Uint8Array(256),F=L.length;function $(){return F>L.length-16&&(Ce(L),F=0),L.slice(F,F+=16)}import{randomUUID as Be}from"crypto";var V={randomUUID:Be};function _e(t,e,o){if(V.randomUUID&&!e&&!t)return V.randomUUID();t=t||{};let s=t.random??t.rng?.()??$();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(o=o||0,o<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let v=0;v<16;++v)e[o+v]=s[v];return e}return X(s)}var Z=_e;var Se=Y(re(),1),ke=Y(oe(),1),Ae=Y(se(),1);function g(t,e){if(t=="--")console.error("[Error] zeus deployment exited abnormally due to an error: 1"),console.error("[Cause] "+e+`
`),process.exit(1);else try{return Te(t,{encoding:"utf8"})}catch(o){console.error("[Error] zeus deployment exited abnormally due to an error: "+o.status),console.error("[Cause] "+e+`
`),process.exit(1)}}function ae(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function Ee(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function Ue(t,e){for(let o=0;o<e.length;o++)if(t===e[o].region)return!0;return!1}function Pe(t){var e=[];for(let s=0;s<t.length;s++){let v=t[s];var o=!1;for(let B=0;B<e.length;B++)if(e[B]===v){o=!0;break}o||e.push(v)}return e}function He(){}var Ne="cdk.context.json",Fe="zeus.json",R="deploy.log";g("echo > "+R,"Problem initializing logfile ... exiting");var T;g("which aws","aws cli is not installed on this host but required, exiting");g("which cdk","aws cdk is not installed on this host but required, exiting");var Le=await ze(new URL("./"+Fe,import.meta.url)),E=JSON.parse(Le),z=E.profile,Oe=E.logRetentionPeriod,De=E.domain,P=E.siteRegions,Ie=E.agent.product,We=E.agent.email,qe=E.agent.tier,Me=E.agent.functions;T=g("aws sts get-caller-identity --profile "+z,"Unable to retrie account id for this profile: ["+z+" ] ... exiting");var ce=JSON.parse(T).Account;T=g("aws configure get region --profile "+z,"Unable to retrie default region for this profile: ["+z+" ] ... exiting");var M=T.replace(/\n|\r/g,"");T=g("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text --profile "+z,"Unable to retrie enabled regions for this profile: ["+z+" ] ... exiting");var le=T.split(`
`).filter(Boolean),Je=g("openssl md5 ./assets/*","Failed to generate chksum file for assets ... exiting"),je=g("cat version","Failed to read the version file ... exiting"),Ye=Je.split(`
`).filter(Boolean),ue={};Ye.forEach(t=>{let e=t.split(")= "),o=e[0].replace("MD5(",""),s=e[1];ue[o]=je.trim()+"_"+s});Ue(M,P)||g("--","The default region: "+M+" must be included in the siteRegions configured, please correct it.");P.forEach(t=>{let e=t.region;ae(e,le)?Ee(e,P)&&g("--","Found duplicate sites for region: "+e+". Only one site per region is permitted."):g("--","Region "+e+" is not enabled on your aws account, please enable it on the console.")});ae(M,le)||g("--","Region "+M+" is not enabled on your aws account, please enable it on the console.");var $e=Z(),Ve={logRetentionPeriod:Oe,account:ce,domain:De,siteRegions:P,systemID:$e,product:Ie,email:We,tier:qe,functions:Me,chksums:ue};await Re("./"+Ne,JSON.stringify(Ve,null,2),t=>{t&&g("--","An error occured saving the CDK Context: "+t)});var G=P.map(t=>t.region),Ze=Pe(G),J="cdk bootstrap ";Ze.forEach(t=>{var e="aws://"+ce+"/"+t+" ";J+=e});J+="--profile "+z+" >> "+R+" 2>&1";g("echo Bootstrap Command:  >> "+R);g("echo "+J+" >> "+R);var fe="cdk deploy --all --require-approval never --profile "+z+" >> "+R+" 2>&1";g("echo Deploy Command:  >> "+R);g("echo "+fe+" >> "+R);g(J,"Something went wrong bootstrapping the environment, see: deploy.log");g(fe,"Something went wrong while deploying the zeus AuthN AuthZ system stacks, see: deploy.log");T=g("grep ZeusEndpoint  "+R+" | awk  '{print $(NF)}'");var Ge=T.split(`
`).filter(Boolean);console.log(`[] zeus Integration Endpoints: ...
`);for(let t=0;t<G.length;t++){let e=t+1;console.log("   [Site "+e+"]: "),console.log("       [Region]:     "+G[t]),console.log("       [Endpoint]:   "+Ge[t]),console.log("")}export{He as default};
