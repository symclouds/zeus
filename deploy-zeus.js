
                import {createRequire} from 'module'
                const require = createRequire(import.meta.url)
            
var ye=Object.create;var X=Object.defineProperty;var we=Object.getOwnPropertyDescriptor;var xe=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,Ce=Object.prototype.hasOwnProperty;var j=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Be=(t,e,o,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let v of xe(e))!Ce.call(t,v)&&v!==o&&X(t,v,{get:()=>e[v],enumerable:!(s=we(e,v))||s.enumerable});return t};var Y=(t,e,o)=>(o=t!=null?ye(be(t)):{},Be(e||!t||!t.__esModule?X(o,"default",{value:t,enumerable:!0}):o,t));var D=N((O,te)=>{(function(t,e){typeof O=="object"?te.exports=O=e():typeof define=="function"&&define.amd?define([],e):t.CryptoJS=e()})(O,function(){var t=t||function(e,o){var s;if(typeof window<"u"&&window.crypto&&(s=window.crypto),typeof self<"u"&&self.crypto&&(s=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(s=globalThis.crypto),!s&&typeof window<"u"&&window.msCrypto&&(s=window.msCrypto),!s&&typeof global<"u"&&global.crypto&&(s=global.crypto),!s&&typeof j=="function")try{s=j("crypto")}catch{}var v=function(){if(s){if(typeof s.getRandomValues=="function")try{return s.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof s.randomBytes=="function")try{return s.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},S=Object.create||function(){function r(){}return function(n){var c;return r.prototype=n,c=new r,r.prototype=null,c}}(),R={},m=R.lib={},y=m.Base=function(){return{extend:function(r){var n=S(this);return r&&n.mixIn(r),(!n.hasOwnProperty("init")||this.init===n.init)&&(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),h=m.WordArray=y.extend({init:function(r,n){r=this.words=r||[],n!=o?this.sigBytes=n:this.sigBytes=r.length*4},toString:function(r){return(r||d).stringify(this)},concat:function(r){var n=this.words,c=r.words,l=this.sigBytes,g=r.sigBytes;if(this.clamp(),l%4)for(var f=0;f<g;f++){var z=c[f>>>2]>>>24-f%4*8&255;n[l+f>>>2]|=z<<24-(l+f)%4*8}else for(var B=0;B<g;B+=4)n[l+B>>>2]=c[B>>>2];return this.sigBytes+=g,this},clamp:function(){var r=this.words,n=this.sigBytes;r[n>>>2]&=4294967295<<32-n%4*8,r.length=e.ceil(n/4)},clone:function(){var r=y.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var n=[],c=0;c<r;c+=4)n.push(v());return new h.init(n,r)}}),w=R.enc={},d=w.Hex={stringify:function(r){for(var n=r.words,c=r.sigBytes,l=[],g=0;g<c;g++){var f=n[g>>>2]>>>24-g%4*8&255;l.push((f>>>4).toString(16)),l.push((f&15).toString(16))}return l.join("")},parse:function(r){for(var n=r.length,c=[],l=0;l<n;l+=2)c[l>>>3]|=parseInt(r.substr(l,2),16)<<24-l%8*4;return new h.init(c,n/2)}},a=w.Latin1={stringify:function(r){for(var n=r.words,c=r.sigBytes,l=[],g=0;g<c;g++){var f=n[g>>>2]>>>24-g%4*8&255;l.push(String.fromCharCode(f))}return l.join("")},parse:function(r){for(var n=r.length,c=[],l=0;l<n;l++)c[l>>>2]|=(r.charCodeAt(l)&255)<<24-l%4*8;return new h.init(c,n)}},i=w.Utf8={stringify:function(r){try{return decodeURIComponent(escape(a.stringify(r)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(r){return a.parse(unescape(encodeURIComponent(r)))}},u=m.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=i.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var n,c=this._data,l=c.words,g=c.sigBytes,f=this.blockSize,z=f*4,B=g/z;r?B=e.ceil(B):B=e.max((B|0)-this._minBufferSize,0);var A=B*f,H=e.min(A*4,g);if(A){for(var U=0;U<A;U+=f)this._doProcessBlock(l,U);n=l.splice(0,A),c.sigBytes-=H}return new h.init(n,H)},clone:function(){var r=y.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0}),b=m.Hasher=u.extend({cfg:y.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){r&&this._append(r);var n=this._doFinalize();return n},blockSize:512/32,_createHelper:function(r){return function(n,c){return new r.init(c).finalize(n)}},_createHmacHelper:function(r){return function(n,c){return new k.HMAC.init(r,c).finalize(n)}}}),k=R.algo={};return R}(Math);return t})});var ne=N((I,re)=>{(function(t,e){typeof I=="object"?re.exports=I=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(I,function(t){return t.enc.Utf8})});var ie=N((W,oe)=>{(function(t,e){typeof W=="object"?oe.exports=W=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(W,function(t){return function(e){var o=t,s=o.lib,v=s.WordArray,S=s.Hasher,R=o.algo,m=[],y=[];(function(){function d(b){for(var k=e.sqrt(b),r=2;r<=k;r++)if(!(b%r))return!1;return!0}function a(b){return(b-(b|0))*4294967296|0}for(var i=2,u=0;u<64;)d(i)&&(u<8&&(m[u]=a(e.pow(i,1/2))),y[u]=a(e.pow(i,1/3)),u++),i++})();var h=[],w=R.SHA256=S.extend({_doReset:function(){this._hash=new v.init(m.slice(0))},_doProcessBlock:function(d,a){for(var i=this._hash.words,u=i[0],b=i[1],k=i[2],r=i[3],n=i[4],c=i[5],l=i[6],g=i[7],f=0;f<64;f++){if(f<16)h[f]=d[a+f]|0;else{var z=h[f-15],B=(z<<25|z>>>7)^(z<<14|z>>>18)^z>>>3,A=h[f-2],H=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;h[f]=B+h[f-7]+H+h[f-16]}var U=n&c^~n&l,he=u&b^u&k^b&k,ge=(u<<30|u>>>2)^(u<<19|u>>>13)^(u<<10|u>>>22),ve=(n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25),Q=g+ve+U+y[f]+h[f],me=ge+he;g=l,l=c,c=n,n=r+Q|0,r=k,k=b,b=u,u=Q+me|0}i[0]=i[0]+u|0,i[1]=i[1]+b|0,i[2]=i[2]+k|0,i[3]=i[3]+r|0,i[4]=i[4]+n|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+g|0},_doFinalize:function(){var d=this._data,a=d.words,i=this._nDataBytes*8,u=d.sigBytes*8;return a[u>>>5]|=128<<24-u%32,a[(u+64>>>9<<4)+14]=e.floor(i/4294967296),a[(u+64>>>9<<4)+15]=i,d.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var d=S.clone.call(this);return d._hash=this._hash.clone(),d}});o.SHA256=S._createHelper(w),o.HmacSHA256=S._createHmacHelper(w)}(Math),t.SHA256})});var ae=N((q,se)=>{(function(t,e){typeof q=="object"?se.exports=q=e(D()):typeof define=="function"&&define.amd?define(["./core"],e):e(t.CryptoJS)})(q,function(t){return function(){var e=t,o=e.lib,s=o.WordArray,v=e.enc,S=v.Base64={stringify:function(m){var y=m.words,h=m.sigBytes,w=this._map;m.clamp();for(var d=[],a=0;a<h;a+=3)for(var i=y[a>>>2]>>>24-a%4*8&255,u=y[a+1>>>2]>>>24-(a+1)%4*8&255,b=y[a+2>>>2]>>>24-(a+2)%4*8&255,k=i<<16|u<<8|b,r=0;r<4&&a+r*.75<h;r++)d.push(w.charAt(k>>>6*(3-r)&63));var n=w.charAt(64);if(n)for(;d.length%4;)d.push(n);return d.join("")},parse:function(m){var y=m.length,h=this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var d=0;d<h.length;d++)w[h.charCodeAt(d)]=d}var a=h.charAt(64);if(a){var i=m.indexOf(a);i!==-1&&(y=i)}return R(m,y,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function R(m,y,h){for(var w=[],d=0,a=0;a<y;a++)if(a%4){var i=h[m.charCodeAt(a-1)]<<a%4*2,u=h[m.charCodeAt(a)]>>>6-a%4*2,b=i|u;w[d>>>2]|=b<<24-d%4*8,d++}return s.create(w,d)}}(),t.enc.Base64})});import{readFile as Te,writeFile as Ee}from"fs/promises";import{execSync as Ue}from"node:child_process";var x=[];for(let t=0;t<256;++t)x.push((t+256).toString(16).slice(1));function ee(t,e=0){return(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase()}import{randomFillSync as _e}from"crypto";var L=new Uint8Array(256),F=L.length;function $(){return F>L.length-16&&(_e(L),F=0),L.slice(F,F+=16)}import{randomUUID as Se}from"crypto";var V={randomUUID:Se};function ke(t,e,o){if(V.randomUUID&&!e&&!t)return V.randomUUID();t=t||{};let s=t.random??t.rng?.()??$();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(o=o||0,o<0||o+16>e.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let v=0;v<16;++v)e[o+v]=s[v];return e}return ee(s)}var Z=ke;var Ae=Y(ne(),1),ze=Y(ie(),1),Re=Y(ae(),1);function p(t,e){if(t=="--")console.error("[Error] zeus deployment exited abnormally due to an error: 1"),console.error("[Cause] "+e+`
`),process.exit(1);else try{return Ue(t,{encoding:"utf8"})}catch(o){console.error("[Error] zeus deployment exited abnormally due to an error: "+o.status),console.error("[Cause] "+e+`
`),process.exit(1)}}function ce(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function Pe(t,e){for(let o=0;o<e.length;o++)if(e[o]==t)return!0;return!1}function He(t,e){for(let o=0;o<e.length;o++)if(t===e[o].region)return!0;return!1}function Ne(t){var e=[];for(let s=0;s<t.length;s++){let v=t[s];var o=!1;for(let S=0;S<e.length;S++)if(e[S]===v){o=!0;break}o||e.push(v)}return e}function Fe(){}var Le="cdk.context.json",le="zeus.json",T="deploy.log";p("echo > "+T,"Problem initializing logfile ... exiting");var C,G;p("which aws","aws cli is not installed on this host but required, exiting");p("which cdk","aws cdk is not installed on this host but required, exiting");var Oe=await Te(new URL("./"+le,import.meta.url)),E=JSON.parse(Oe),_=E.profile,De=E.logRetentionPeriod,Ie=E.domain,P=E.siteRegions,We=E.agent.product,qe=E.agent.email,Me=E.agent.tier,Je=E.agent.functions,je=p("whoami","");je==="cloudshell-user"?G=!1:(C=p("aws configure list-profiles | grep "+_,"Could not list aws profiles"),C!==_?p("--","The profile name provided in "+le+" is not found ... exiting"):G=!0);C=p("aws sts get-caller-identity --profile "+_,"Unable to retrie account id for this profile: ["+_+" ] ... exiting");C=G?C=p("aws sts get-caller-identity --profile "+_,"Unable to retrie account id for this profile: ["+_+" ] ... exiting"):C=p("aws sts get-caller-identity","Unable to retrie account id ... exiting");var ue=JSON.parse(C).Account;console.log(C);C=p("aws configure get region --profile "+_,"Unable to retrie default region for this profile: ["+_+" ] ... exiting");var M=C.replace(/\n|\r/g,"");C=p("aws ec2 describe-regions --query 'Regions[].{Name:RegionName}' --output text --profile "+_,"Unable to retrie enabled regions for this profile: ["+_+" ] ... exiting");var fe=C.split(`
`).filter(Boolean),Ye=p("openssl md5 ./assets/*","Failed to generate chksum file for assets ... exiting"),$e=p("cat version","Failed to read the version file ... exiting"),Ve=Ye.split(`
`).filter(Boolean),de={};Ve.forEach(t=>{let e=t.split(")= "),o=e[0].replace("MD5(",""),s=e[1];de[o]=$e.trim()+"_"+s});He(M,P)||p("--","The default region: "+M+" must be included in the siteRegions configured, please correct it.");P.forEach(t=>{let e=t.region;ce(e,fe)?Pe(e,P)&&p("--","Found duplicate sites for region: "+e+". Only one site per region is permitted."):p("--","Region "+e+" is not enabled on your aws account, please enable it on the console.")});ce(M,fe)||p("--","Region "+M+" is not enabled on your aws account, please enable it on the console.");var Ze=Z(),Ge={logRetentionPeriod:De,account:ue,domain:Ie,siteRegions:P,systemID:Ze,product:We,email:qe,tier:Me,functions:Je,chksums:de};await Ee("./"+Le,JSON.stringify(Ge,null,2),t=>{t&&p("--","An error occured saving the CDK Context: "+t)});var K=P.map(t=>t.region),Ke=Ne(K),J="cdk bootstrap ";Ke.forEach(t=>{var e="aws://"+ue+"/"+t+" ";J+=e});J+="--profile "+_+" >> "+T+" 2>&1";p("echo Bootstrap Command:  >> "+T);p("echo "+J+" >> "+T);var pe="cdk deploy --all --require-approval never --profile "+_+" >> "+T+" 2>&1";p("echo Deploy Command:  >> "+T);p("echo "+pe+" >> "+T);p(J,"Something went wrong bootstrapping the environment, see: deploy.log");p(pe,"Something went wrong while deploying the zeus AuthN AuthZ system stacks, see: deploy.log");C=p("grep ZeusEndpoint  "+T+" | awk  '{print $(NF)}'");var Qe=C.split(`
`).filter(Boolean);console.log(`[] zeus Integration Endpoints: ...
`);for(let t=0;t<K.length;t++){let e=t+1;console.log("   [Site "+e+"]: "),console.log("       [Region]:     "+K[t]),console.log("       [Endpoint]:   "+Qe[t]),console.log("")}export{Fe as default};
